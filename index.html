<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <title>NeXt Editor</title>
    <style>
        /* Layout Generale */
        body { margin: 0; display: flex; height: 100vh; font-family: sans-serif; overflow: hidden; }
        
        /* Colonna Sinistra (Editor) */
        .editor-container { 
            width: 50%; 
            display: flex; 
            flex-direction: column; 
            border-right: 1px solid #ccc; 
            background: #1e1e1e; 
        }
        
        /* Header */
        .header { 
            background: #007acc; 
            color: white; 
            padding: 10px 20px; 
            font-weight: bold; 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        
        /* Area di Testo */
        textarea { 
            flex: 1; 
            padding: 20px; 
            font-family: 'Consolas', 'Monaco', monospace; 
            font-size: 14px; 
            line-height: 1.5;
            border: none; 
            resize: none; 
            background: #1e1e1e; 
            color: #d4d4d4; 
            outline: none; 
        }

        /* Colonna Destra (Anteprima) */
        iframe { 
            width: 50%; 
            height: 100%; 
            border: none; 
            background: white; 
        }
        
        /* Bottoni */
        .btn-group { display: flex; gap: 10px; }
        button { 
            border: none; 
            padding: 8px 15px; 
            cursor: pointer; 
            border-radius: 4px; 
            font-weight: bold; 
            font-size: 13px; 
            transition: opacity 0.2s;
        }
        .btn-update { background: white; color: #007acc; }
        .btn-pdf { background: #e74c3c; color: white; } /* Rosso PDF */
        button:hover { opacity: 0.9; }
    </style>
</head>
<body>

    <div class="editor-container">
        <div class="header">
            <span>NeXt Editor v1.0 ðŸš€</span>
            <div class="btn-group">
                <button class="btn-update" onclick="update()">Aggiorna (CTRL+S)</button>
                <button class="btn-pdf" onclick="downloadPDF()">ðŸ“„ Scarica PDF</button>
            </div>
        </div>
        
        <textarea id="input" spellcheck="false">@title{Manuale NeXt}

# Benvenuto in NeXt
NeXt Ã¨ un linguaggio semplice per creare documenti scientifici e professionali.
Ecco come si usa:

## 1. Testo e Stile
Scrivi normalmente per i paragrafi.
Usa gli asterischi per il **grassetto**.
Usa i trattini per le liste:
- Primo punto
- Secondo punto

## 2. Matematica (LaTeX)
NeXt supporta formule complesse tra i dollari:
$ E = mc^2 $

Oppure integrali e frazioni:
$ \int_{-\infty}^{\infty} e^{-x^2} dx = \sqrt{\pi} $

## 3. Tabelle
Crea tabelle usando le barre verticali:
| Comando | Descrizione |
| :--- | :--- |
| ** | Grassetto |
| $ | Matematica |
| @title | Titolo Doc |
</textarea>
    </div>

    <iframe id="preview" name="previewFrame"></iframe>

    <script type="module">
        import init, { compile_next_to_html } from './pkg/next.js';

        async function run() {
            // Avvia il motore Rust
            await init();
            
            // Funzione di aggiornamento
            window.update = () => {
                const text = document.getElementById('input').value;
                const html = compile_next_to_html(text);
                const doc = document.getElementById('preview').contentWindow.document;
                
                doc.open(); 
                doc.write(html); 
                doc.close();
            };

            // Funzione per scaricare il PDF (stampa solo l'iframe)
            window.downloadPDF = () => {
                const iframe = document.getElementById('preview');
                iframe.contentWindow.focus();
                iframe.contentWindow.print();
            };

            // Aggiorna al primo avvio
            update();

            // Aggiorna ogni volta che l'utente scrive
            document.getElementById('input').addEventListener('input', update);
            
            // Scorciatoia da tastiera: CTRL+S per aggiornare (opzionale)
            document.addEventListener('keydown', function(e) {
                if ((e.ctrlKey || e.metaKey) && e.key === 's') {
                    e.preventDefault();
                    update();
                }
            });
        }
        run();
    </script>
</body>
</html>