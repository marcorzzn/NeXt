<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <title>NeXt Editor</title>
    <style>
        body { margin: 0; display: flex; height: 100vh; font-family: sans-serif; overflow: hidden; }
        .editor-container { width: 50%; display: flex; flex-direction: column; border-right: 1px solid #ccc; background: #1e1e1e; }
        textarea { flex: 1; padding: 20px; font-family: 'Consolas', monospace; font-size: 14px; border: none; resize: none; background: #1e1e1e; color: #d4d4d4; outline: none; }
        .header { background: #007acc; color: white; padding: 10px 20px; font-weight: bold; display: flex; justify-content: space-between; align-items: center; }
        iframe { width: 50%; height: 100%; border: none; background: white; }
        
        /* Stile dei bottoni */
        .btn-group { display: flex; gap: 10px; }
        button { border: none; padding: 6px 15px; cursor: pointer; border-radius: 3px; font-weight: bold; font-size: 13px; }
        .btn-update { background: white; color: #007acc; }
        .btn-pdf { background: #e74c3c; color: white; } /* Rosso per il PDF */
        button:hover { opacity: 0.9; }
    </style>
</head>
<body>
    <div class="editor-container">
        <div class="header">
            <span>NeXt Editor ðŸš€</span>
            <div class="btn-group">
                <button class="btn-update" onclick="update()">Aggiorna Anteprima</button>
                <button class="btn-pdf" onclick="downloadPDF()">ðŸ“„ Scarica PDF</button>
            </div>
        </div>
        <textarea id="input" spellcheck="false">@title{Il Mio Primo Documento}

# Funziona!
Questo documento verrÃ  stampato perfettamente pulito.

## Matematica
$x = \frac{-b \pm \sqrt{b^2-4ac}}{2a}$

## Tabella
| Prodotto | Prezzo |
| :--- | :--- |
| NeXt | Gratis |
| PDF | Incluso |
</textarea>
    </div>
    
    <iframe id="preview" name="previewFrame"></iframe>

    <script type="module">
        import init, { compile_next_to_html } from './pkg/next.js';

        async function run() {
            await init();
            
            window.update = () => {
                const text = document.getElementById('input').value;
                const html = compile_next_to_html(text);
                const doc = document.getElementById('preview').contentWindow.document;
                doc.open(); 
                doc.write(html); 
                doc.close();
            };

            // Funzione Specifica per il PDF
            window.downloadPDF = () => {
                const iframe = document.getElementById('preview');
                // Questo comando dice: "Stampa solo il contenuto dell'iframe"
                iframe.contentWindow.focus();
                iframe.contentWindow.print();
            };

            update();
            document.getElementById('input').addEventListener('input', update);
        }
        run();
    </script>
</body>
</html>
