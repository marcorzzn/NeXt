<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <title>NeXt Editor</title>
    <style>
        /* --- LAYOUT GENERALE --- */
        * { box-sizing: border-box; }
        body { 
            margin: 0; 
            padding: 0;
            display: flex; 
            flex-direction: column; /* Impila Header sopra, contenuto sotto */
            height: 100vh; 
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; 
            overflow: hidden; 
            background-color: #1e1e1e; /* Sfondo scuro per evitare flash bianchi */
        }
        
        /* --- HEADER FULL WIDTH --- */
        .header { 
            height: 50px;
            width: 100%;
            background: #252526; /* Grigio scuro VS Code style */
            border-bottom: 1px solid #333;
            color: #cccccc; 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            padding: 0 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.3);
            z-index: 10;
        }

        .brand {
            font-weight: 600;
            font-size: 16px;
            letter-spacing: 0.5px;
            color: #ffffff;
        }
        
        /* --- AREA PRINCIPALE (EDITOR + PREVIEW) --- */
        .main-container {
            display: flex;
            flex: 1; /* Occupa tutto lo spazio rimanente sotto l'header */
            height: calc(100vh - 50px);
        }

        /* --- COLONNA SINISTRA (EDITOR) --- */
        .editor-wrapper { 
            width: 50%; 
            height: 100%;
            display: flex; 
            flex-direction: column; 
            border-right: 1px solid #333; 
            background: #1e1e1e; 
        }
        
        textarea { 
            width: 100%;
            height: 100%;
            padding: 20px; 
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace; 
            font-size: 14px; 
            line-height: 1.6;
            border: none; 
            resize: none; 
            background: #1e1e1e; 
            color: #d4d4d4; 
            outline: none; 
        }

        /* Scrollbar scura personalizzata */
        textarea::-webkit-scrollbar { width: 10px; }
        textarea::-webkit-scrollbar-track { background: #1e1e1e; }
        textarea::-webkit-scrollbar-thumb { background: #424242; border-radius: 5px; }

        /* --- COLONNA DESTRA (ANTEPRIMA) --- */
        iframe { 
            width: 50%; 
            height: 100%; 
            border: none; 
            background: white; 
        }
        
        /* --- BOTTONI ARMONIOSI --- */
        .btn-group { display: flex; gap: 12px; }
        
        button { 
            border: none; 
            padding: 6px 14px; 
            cursor: pointer; 
            border-radius: 4px; 
            font-size: 13px; 
            font-weight: 500;
            transition: all 0.2s ease;
        }

        /* Bottone Aggiorna: Blu scuro elegante */
        .btn-update { 
            background: #0e639c; 
            color: white; 
        }
        .btn-update:hover { background: #1177bb; }

        /* Bottone PDF: Grigio chiaro con testo scuro (o accento diverso) */
        .btn-pdf { 
            background: #3c3c3c; 
            color: #e0e0e0; 
            border: 1px solid #555;
        }
        .btn-pdf:hover { 
            background: #4a4a4a; 
            color: #fff;
            border-color: #666;
        }

    </style>
</head>
<body>

    <div class="header">
        <div class="brand">NeXt Editor</div>
        <div class="btn-group">
            <button class="btn-update" onclick="update()">Aggiorna (CTRL+S)</button>
            <button class="btn-pdf" onclick="downloadPDF()">Scarica PDF</button>
        </div>
    </div>

    <div class="main-container">
        
        <div class="editor-wrapper">
            <textarea id="input" spellcheck="false" placeholder="Inizia a scrivere qui...">@title{Manuale NeXt}

# Benvenuto in NeXt
NeXt Ã¨ un linguaggio semplice per creare documenti scientifici e professionali.
Ecco come si usa:

## 1. Testo e Stile
Scrivi normalmente per i paragrafi.
Usa gli asterischi per il **grassetto**.
Usa i trattini per le liste:
- Primo punto
- Secondo punto

## 2. Matematica (LaTeX)
NeXt supporta formule complesse tra i dollari (puoi incollare da ChatGPT!):
$ E = mc^2 $

Oppure integrali e frazioni:
$ \int_{-\infty}^{\infty} e^{-x^2} dx = \sqrt{\pi} $

## 3. Tabelle
Crea tabelle usando le barre verticali:
| Comando | Descrizione |
| :--- | :--- |
| ** | Grassetto |
| $ | Matematica |
| @title | Titolo Doc |
</textarea>
        </div>

        <iframe id="preview" name="previewFrame"></iframe>
    </div>

    <script type="module">
        import init, { compile_next_to_html } from './pkg/next.js';

        async function run() {
            await init();
            
            window.update = () => {
                const text = document.getElementById('input').value;
                const html = compile_next_to_html(text);
                const doc = document.getElementById('preview').contentWindow.document;
                
                doc.open(); 
                doc.write(html); 
                doc.close();
            };

            window.downloadPDF = () => {
                const iframe = document.getElementById('preview');
                iframe.contentWindow.focus();
                iframe.contentWindow.print();
            };

            // Primo render
            update();

            // Event Listeners
            document.getElementById('input').addEventListener('input', update);
            document.addEventListener('keydown', function(e) {
                if ((e.ctrlKey || e.metaKey) && e.key === 's') {
                    e.preventDefault();
                    update();
                }
            });
        }
        run();
    </script>
</body>
</html>